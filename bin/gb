#!/bin/bash
set -e
. "$(dirname "$(readlink -f "$0")")"/lib/util.sh
[ "$#" -ge 2 ] || die "Usage: $0 <branch> <command>"
[ "$(basename "$0")" != "gbb" ] || gbb=1
branch="$1"
shift
cmd git checkout "$branch"
if ! cmd git "$@" && [ $gbb ]; then
    die "git command failed, you are now on branch '$branch'"
fi
[ ! $gbb ] || git checkout @{-1}
